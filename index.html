<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>InScope â€“ Bilingual Exchange @ USYD</title>
  <meta name="description" content="InScope â€“ A bilingual (EN/ä¸­æ–‡) student-led language exchange at USYD." />
  <link rel="icon" href="/favicon.ico" />
  <style>
    :root{
      --brand-700:#1E3AFF;
      --brand-600:#2F5BFF;
      --accent:#FFC83D;
      --ink:#0F172A;
      --card:#fff;
      --radius:16px;
      --shadow:0 8px 20px rgba(0,0,0,.1);
      --deep-blue:#0b3a7c;
      --muted:#475569;
    }
    body{margin:0;font-family:ui-sans-serif,system-ui;line-height:1.6;background:#f3f6fb}
    a{text-decoration:none}
    .nav{position:sticky;top:0;z-index:50;background:#fff;border-bottom:1px solid #e5e7eb}
    .nav-inner{display:flex;align-items:center;justify-content:space-between;max-width:1100px;margin:0 auto;padding:10px 20px}
    .brand-plate{display:flex;align-items:center;gap:10px;background:#fff;border:1px solid #e5e7eb;border-radius:999px;padding:4px 10px;box-shadow:var(--shadow)}
    .brand-plate img{height:40px}
    .brand-text{font-weight:800;color:#0b1b4a}
    .menu{display:flex;gap:18px;align-items:center}
    .menu a{font-weight:600;color:#0f172a}
    .cta{background:var(--brand-700);color:#fff;font-weight:700;padding:8px 14px;border-radius:999px}
    .hamburger{display:none}
    @media(max-width:850px){.menu{display:none}.hamburger{display:block}}

    .hero{position:relative;color:#fff;text-align:left;background: url("assets/BG1.png") center bottom / contain no-repeat;background-color:#fff;min-height:78vh;}
    .hero .wrap{position: relative;z-index: 1;max-width: 1100px;margin: 0 auto;padding: 200px 20px 100px;}
    .hero-logo-plate{display:inline-flex;align-items:center;gap:12px;background:#fff;border:1px solid #e5e7eb;border-radius:16px;padding:10px 14px;box-shadow:var(--shadow)}
    .hero-logo-plate img{height:80px}
    .hero-logo-plate .text{font-weight:900;font-size:22px;color:#0b1b4a}
    h1 {font-size: 48px;line-height: 1.2;margin: 20px 0;color: #fff;text-shadow: 0 4px 12px rgba(0,0,0,0.6);}
    .actions{display:flex;gap:12px;margin-top:20px;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;gap:6px;padding:12px 18px;border-radius:999px;font-weight:700;border:2px solid transparent;cursor:pointer}
    .btn.primary{background:#fff;color:#1E3AFF;border-color:#dbeafe}
    .btn.outline{background:rgba(30,58,138,0.85);color:#fff;border:2px solid #1E3AFF}
    .btn.outline:hover { background:#1E3AFF; border-color:#1E3AFF; }

    section{padding:60px 20px}
    .container{max-width:1100px;margin:0 auto}
    .surface{background:var(--card);border:1px solid #e5e7eb;border-radius:var(--radius);box-shadow:var(--shadow);padding:28px}
    .section-title{font-size:26px;display:flex;align-items:center;gap:8px;margin:0 0 18px}
    .badge-key{display:inline-flex;width:28px;height:28px;align-items:center;justify-content:center;border:1px solid #e5e7eb;border-radius:6px;background:#fff;box-shadow:var(--shadow)}
    .grid{display:grid;gap:18px;grid-template-columns:repeat(auto-fit,minmax(250px,1fr))}
    .card{background:#fff;border:1px solid #e5e7eb;border-radius:var(--radius);padding:18px;box-shadow:var(--shadow)}
    .meta{color:#64748b;font-size:14px}

    .section-wrap{display:grid;grid-template-columns:320px 1fr;gap:22px;align-items:start;}
    .section-img{background:#0c3b82;border-radius:16px;overflow:hidden;border:1px solid #e5e7eb;box-shadow:var(--shadow);}
    .section-img img{display:block;width:100%;height:auto}

    footer{background:var(--deep-blue);border-top:1px solid rgba(255,255,255,.15);padding:40px 20px;color:#eaf2ff}
    .footer-grid{display:grid;gap:18px;grid-template-columns:2fr 1fr 1fr 1fr;max-width:1100px;margin:0 auto}
    .footer-grid a{color:#fff}
    .brand-plate.footer{box-shadow:none;border-color:rgba(255,255,255,.25);background:rgba(255,255,255,.92)}
    .copyright{text-align:center;margin-top:20px;font-size:13px;color:#e4edff}
    @media(max-width:900px){.footer-grid{grid-template-columns:1fr 1fr}.section-wrap{grid-template-columns:1fr}}

    /* Modals */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;z-index:1000}
    .modal{width:min(520px,90vw);background:#fff;border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 12px 40px rgba(0,0,0,.18);padding:22px}
    .modal h3{margin:0 0 10px;font-size:20px}
    .modal .row{display:flex;gap:10px;margin:10px 0}
    .modal input{flex:1;padding:10px;border:1px solid #d1d5db;border-radius:10px;font-size:14px}
    .modal button{padding:10px 14px;border-radius:10px;border:1px solid #1E3AFF;background:#1E3AFF;color:#fff;font-weight:700;cursor:pointer}
    .modal .ghost{background:#fff;color:#1E3AFF}
    .modal .msg{font-size:13px;color:#475569;min-height:20px;margin-top:4px}
    .modal .link{font-size:13px;color:#2563eb;cursor:pointer}
    .auth-chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;background:#fff;color:#0f172a;margin-left:10px}
    #pwd-req-list li{color:#64748b}
    #pwd-req-list li.ok{color:#059669;font-weight:600}
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="nav">
    <div class="nav-inner">
      <a class="brand-plate" href="#home"><img src="assets/inscope_logo.png" alt=""><span class="brand-text">InScope</span></a>
      <div class="menu">
        <a href="#sessions">Sessions æ´»åŠ¨</a>
        <a href="#how">How It Works ä½¿ç”¨æ–¹å¼</a>
        <a href="#resources">Resources èµ„æº</a>
        <a href="#about">About å…³äº</a>
        <a class="cta" href="#sessions">Join åŠ å…¥</a>
      </div>
      <button class="hamburger">â˜°</button>
    </div>
  </nav>

  <!-- HERO -->
  <header id="home" class="hero">
    <div class="wrap">
      <div class="hero-logo-plate"><img src="assets/inscope_logo.png" alt=""><span class="text">InScope</span></div>
      <h1>Practice languages in English & Chinese Â· ä¸­è‹±åŒè¯­äº¤æµ</h1>
      <div class="actions">
        <a class="btn primary" href="#sessions">Join a Session å‚åŠ æ´»åŠ¨</a>
        <button class="btn outline" id="btn-hero-register">Register æ³¨å†Œ</button>
        <button class="btn outline" id="btn-hero-login">Login ç™»å½•</button>
      </div>
    </div>
  </header>

  <!-- HOW -->
  <section id="how">
    <div class="container">
      <div class="section-wrap">
        <aside class="section-img">
          <img src="assets/BG2.png" alt="How it works illustration">
        </aside>
        <div class="surface">
          <h2 class="section-title"><span class="badge-key">ğŸ¹</span> How It Works Â· ä½¿ç”¨æ–¹å¼</h2>
          <div class="grid">
            <div class="card">Step 1 Â· Pick a table é€‰æ‹©è¯­è¨€æ¡Œ</div>
            <div class="card">Step 2 Â· Share & practice åˆ†äº«ç»ƒä¹ </div>
            <div class="card">Step 3 Â· Reflect & connect äº¤æµæ‹“å±•</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SESSIONS -->
  <section id="sessions">
    <div class="container">
      <div class="section-wrap">
        <aside class="section-img">
          <img src="assets/BG3.png" alt="Sessions illustration">
        </aside>
        <div class="surface">
          <h2 class="section-title"><span class="badge-key">ğŸ¹</span> Sessions æ´»åŠ¨</h2>
          <div class="grid" id="courses-grid">
            <div class="card">Loading coursesâ€¦ åŠ è½½ä¸­â€¦</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- RESOURCES -->
  <section id="resources">
    <div class="container">
      <div class="section-wrap">
        <aside class="section-img">
          <img src="assets/BG4.png" alt="Resources illustration">
        </aside>
        <div class="surface">
          <h2 class="section-title"><span class="badge-key">ğŸ¹</span> Resources èµ„æº</h2>
          <div class="grid">
            <div class="card">Resource 1</div>
            <div class="card">Resource 2</div>
            <div class="card">Resource 3</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about">
    <div class="container surface">
      <h2 class="section-title"><span class="badge-key">ğŸ¹</span> About å…³äº</h2>
      <div class="card"><p>InScope is a not-for-profit, student-run bilingual exchange. Â· å­¦ç”Ÿè‡ªå‘ã€éè¥åˆ©çš„åŒè¯­äº¤æµé¡¹ç›®ã€‚</p></div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer>
    <div class="footer-grid">
      <div>
        <div class="brand-plate footer"><img src="assets/inscope_logo.png" alt=""><span class="brand-text">InScope</span></div>
        <p>A student-led bilingual exchange at USYD Â· æ‚‰å°¼å¤§å­¦å­¦ç”ŸåŒè¯­äº¤æµã€‚</p>
      </div>
      <div><strong>Explore</strong><div><a href="#sessions">Sessions</a></div><div><a href="#resources">Resources</a></div></div>
      <div><strong>Project</strong><div><a href="#how">How it works</a></div><div><a href="#about">About</a></div></div>
      <div><strong>Get in touch</strong><div><a href="https://www.instagram.com/inscope_vibes?igsh=MXo2cnk4ZWl1ZXY=">InScope Team</a></div></div>
    </div>
    <div class="copyright">Â© <span id="y"></span> InScope. Made with â™¥ in Sydney.</div>
  </footer>

  <!-- ===== Auth Modals ===== -->
  <div id="modal-register" class="modal-overlay" aria-hidden="true">
    <div class="modal">
      <h3>Register Â· æ³¨å†Œ</h3>
      <div id="reg-step-1">
        <div class="row"><input id="reg-email" type="email" placeholder="Email é‚®ç®±" /></div>
        <div class="row">
          <button id="btn-send-code">Send code å‘é€éªŒè¯ç </button>
          <button class="ghost" data-close>Cancel å–æ¶ˆ</button>
        </div>
        <div class="msg" id="reg-msg-1"></div>
      </div>
      <div id="reg-step-2" style="display:none">
        <div class="row"><input id="reg-code" inputmode="numeric" maxlength="6" placeholder="6-digit code å…­ä½éªŒè¯ç " /></div>
        <div class="row">
          <button id="btn-verify-code">Verify éªŒè¯</button>
          <button class="ghost" data-back>Back è¿”å›</button>
        </div>
        <div class="msg" id="reg-msg-2"></div>
      </div>
      <div id="reg-step-3" style="display:none">
        <div class="row"><input id="reg-username" placeholder="Username ç”¨æˆ·å" /></div>
        <div class="row"><input id="reg-password" type="password" placeholder="Password å¯†ç ï¼ˆè‡³å°‘8ä½ï¼Œå«å¤§å°å†™/æ•°å­—/ç¬¦å·ï¼‰" /></div>

        <div class="msg" id="pwd-req" style="line-height:1.4">
          <div><strong>å¯†ç è¦æ±‚ Â· Password must include:</strong></div>
          <ul id="pwd-req-list" style="margin:6px 0 0 16px;padding:0;">
            <li data-req="len">â‰¥ 8 ä¸ªå­—ç¬¦</li>
            <li data-req="upper">è‡³å°‘ 1 ä¸ªå¤§å†™å­—æ¯</li>
            <li data-req="lower">è‡³å°‘ 1 ä¸ªå°å†™å­—æ¯</li>
            <li data-req="digit">è‡³å°‘ 1 ä¸ªæ•°å­—</li>
            <li data-req="symbol">è‡³å°‘ 1 ä¸ªç¬¦å·ï¼ˆ!@#$%^&* ç­‰ï¼‰</li>
            <li data-req="noemail">ä¸èƒ½åŒ…å«é‚®ç®±å‰ç¼€</li>
            <li data-req="nouser">ä¸èƒ½åŒ…å«ç”¨æˆ·å</li>
          </ul>
        </div>

        <div class="row">
          <button id="btn-register" disabled>Create account åˆ›å»ºè´¦å·</button>
          <button class="ghost" data-close>Close å…³é—­</button>
        </div>
        <div class="msg" id="reg-msg-3"></div>
      </div>
    </div>
  </div>

  <div id="modal-login" class="modal-overlay" aria-hidden="true">
    <div class="modal">
      <h3>Login Â· ç™»å½•</h3>
      <div class="row"><input id="login-email" type="email" placeholder="Email é‚®ç®±" /></div>
      <div class="row"><input id="login-password" type="password" placeholder="Password å¯†ç " /></div>
      <div class="row">
        <button id="btn-login">Login ç™»å½•</button>
        <button class="ghost" data-close>Cancel å–æ¶ˆ</button>
      </div>
      <div class="msg" id="login-msg"></div>
    </div>
  </div>
  <!-- ===== /Auth Modals ===== -->

  <script>
    document.getElementById('y').textContent = new Date().getFullYear();
  </script>

  <!-- ===== Main Script ===== -->
  <script>
  (() => {
    const API_BASE = 'https://inscope-backend.onrender.com';
    const JSON_HEADERS = {'Content-Type':'application/json'};
    let accessToken = null;

    const $ = (sel, root=document) => root.querySelector(sel);
    const show = el => { el.style.display='flex'; el.setAttribute('aria-hidden','false'); };
    const hide = el => { el.style.display='none'; el.setAttribute('aria-hidden','true'); };

    // ===== API helpers =====
    async function apiPost(path, body, { withAuth=false, withCookie=false } = {}) {
      const headers = { ...JSON_HEADERS };
      if (withAuth && accessToken) headers['Authorization'] = `Bearer ${accessToken}`;
      const res = await fetch(`${API_BASE}${path}`, {
        method:'POST', headers, body: JSON.stringify(body || {}),
        credentials: withCookie ? 'include' : 'omit'
      });
      const json = await res.json().catch(()=>({}));
      return { status: res.status, json };
    }
    async function apiGet(path, { withAuth=false } = {}) {
      const headers = {};
      if (withAuth && accessToken) headers['Authorization'] = `Bearer ${accessToken}`;
      const res = await fetch(`${API_BASE}${path}`, { headers });
      const json = await res.json().catch(()=>({}));
      return { status: res.status, json };
    }

    // ===== Hero æŒ‰é’®ç»‘å®šï¼ˆæ‰“å¼€æ¨¡æ€ï¼‰ =====
    document.getElementById('btn-hero-register')?.addEventListener('click', e => {
      e.preventDefault(); show(document.getElementById('modal-register'));
    });
    document.getElementById('btn-hero-login')?.addEventListener('click', e => {
      e.preventDefault(); show(document.getElementById('modal-login'));
    });

    // ===== å…³é—­/è¿”å› =====
    document.querySelectorAll('[data-close]').forEach(el => el.onclick = () => {
      hide(document.getElementById('modal-register'));
      hide(document.getElementById('modal-login'));
      // é‡ç½®è¡¨å•
      document.getElementById('reg-step-1').style.display='block';
      document.getElementById('reg-step-2').style.display='none';
      document.getElementById('reg-step-3').style.display='none';
      document.getElementById('reg-msg-1').textContent =
        document.getElementById('reg-msg-2').textContent =
        document.getElementById('reg-msg-3').textContent = '';
      document.getElementById('reg-email').value =
        document.getElementById('reg-code').value =
        document.getElementById('reg-username').value =
        document.getElementById('reg-password').value = '';
      document.getElementById('login-msg').textContent = '';
    });
    document.querySelectorAll('[data-back]').forEach(el => el.onclick = () => {
      document.getElementById('reg-step-2').style.display='none';
      document.getElementById('reg-step-1').style.display='block';
      document.getElementById('reg-msg-1').textContent='';
    });

    // ===== æ³¨å†Œæµç¨‹ =====
    let registrationToken = null;

    document.getElementById('btn-send-code').onclick = async () => {
      const email = document.getElementById('reg-email').value.trim();
      document.getElementById('reg-msg-1').textContent = 'å‘é€ä¸­â€¦ / Sendingâ€¦';
      const { status, json } = await apiPost('/api/v1/auth/request-code', { email });
      if (status === 200 && json.ok) {
        document.getElementById('reg-msg-1').textContent = 'å·²å‘é€éªŒè¯ç ï¼Œè¯·æŸ¥æ”¶ã€‚';
        document.getElementById('reg-step-1').style.display='none';
        document.getElementById('reg-step-2').style.display='block';
        document.getElementById('reg-code').focus();
      } else {
        document.getElementById('reg-msg-1').textContent = json.message || 'å‘é€å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚';
      }
    };

    document.getElementById('btn-verify-code').onclick = async () => {
      const email = document.getElementById('reg-email').value.trim();
      const code  = document.getElementById('reg-code').value.trim();
      document.getElementById('reg-msg-2').textContent = 'éªŒè¯ä¸­â€¦ / Verifyingâ€¦';
      const { status, json } = await apiPost('/api/v1/auth/verify-code', { email, code });
      if (status === 200 && json.ok) {
        registrationToken = json.registration_token;
        document.getElementById('reg-msg-2').textContent = 'éªŒè¯æˆåŠŸï¼Œè¯·è®¾ç½®ç”¨æˆ·åä¸å¯†ç ã€‚';
        document.getElementById('reg-step-2').style.display='none';
        document.getElementById('reg-step-3').style.display='block';
        document.getElementById('reg-username').focus();

        // â­ å…³é”®ï¼šç«‹å³åˆ·æ–°æŒ‰é’®å¯ç”¨çŠ¶æ€ï¼Œé¿å…æŸäº›ç¯å¢ƒä¸‹ MutationObserver ä¸è§¦å‘
        evaluatePassword();
      } else {
        document.getElementById('reg-msg-2').textContent = json.message || 'éªŒè¯ç é”™è¯¯æˆ–å·²è¿‡æœŸã€‚';
      }
    };

    // ===== å¯†ç è§„åˆ™ & æŒ‰é’®å¯ç”¨ =====
    const pwdInput = document.getElementById('reg-password');
    const userInput = document.getElementById('reg-username');
    const emailInput = document.getElementById('reg-email');
    const btnCreate = document.getElementById('btn-register');

    function evaluatePassword() {
      const pwd = (pwdInput?.value || '');
      const username = (userInput?.value || '').trim().toLowerCase();
      const email = (emailInput?.value || '').trim().toLowerCase();
      const emailPrefix = email.split('@')[0] || '';

      const checks = {
        len:    pwd.length >= 8,
        upper:  /[A-Z]/.test(pwd),
        lower:  /[a-z]/.test(pwd),
        digit:  /\d/.test(pwd),
        symbol: /[^A-Za-z0-9]/.test(pwd),
        noemail: emailPrefix ? !pwd.toLowerCase().includes(emailPrefix) : true,
        nouser: username ? !pwd.toLowerCase().includes(username) : true,
      };

      document.querySelectorAll('#pwd-req-list li').forEach(li => {
        const key = li.getAttribute('data-req');
        li.classList.toggle('ok', !!checks[key]);
      });

      const allOk = Object.values(checks).every(Boolean);
      if (btnCreate) btnCreate.disabled = !allOk;
    }

    ['input','change'].forEach(evt => {
      pwdInput?.addEventListener(evt, evaluatePassword);
      userInput?.addEventListener(evt, evaluatePassword);
      emailInput?.addEventListener(evt, evaluatePassword);
    });

    // ===== åˆ›å»ºè´¦å· =====
    document.getElementById('btn-register').onclick = async () => {
      const username = document.getElementById('reg-username').value.trim();
      const password = document.getElementById('reg-password').value;
      if (!registrationToken) { document.getElementById('reg-msg-3').textContent = 'è¯·å…ˆå®Œæˆé‚®ç®±éªŒè¯ã€‚'; return; }
      document.getElementById('reg-msg-3').textContent = 'åˆ›å»ºä¸­â€¦ / Creatingâ€¦';
      const res = await fetch(`${API_BASE}/api/v1/auth/register`, {
        method:'POST',
        headers: { ...JSON_HEADERS, Authorization: `Bearer ${registrationToken}` },
        credentials: 'include',
        body: JSON.stringify({ username, password })
      });
      const json = await res.json().catch(()=>({}));
      if (res.ok && json.ok) {
        accessToken = json.access_token;
        document.getElementById('reg-msg-3').textContent = 'æ³¨å†ŒæˆåŠŸï¼å·²ç™»å½•ã€‚';
        renderAuthChip(json.user);
        setTimeout(() => { hide(document.getElementById('modal-register')); }, 600);
      } else {
        document.getElementById('reg-msg-3').textContent = (json && (json.message || json.code)) || 'æ³¨å†Œå¤±è´¥ã€‚';
      }
    };

    // ===== ç™»å½• / åˆ·æ–° / ç™»å‡º =====
    async function tryRefresh() {
      const res = await fetch(`${API_BASE}/api/v1/auth/refresh`, {
        method:'POST',
        credentials:'include',
        headers: JSON_HEADERS
      });
      if (res.ok) {
        const data = await res.json();
        accessToken = data.access_token;
        renderAuthChip(data.user);
        return true;
      }
      return false;
    }

    function renderAuthChip(user) {
      const plate = document.querySelector('.brand-plate');
      if (!plate) return;

      const old = document.getElementById('auth-chip');
      if (old) old.remove();

      const chip = document.createElement('span');
      chip.id = 'auth-chip';
      chip.className = 'auth-chip';
      chip.innerHTML = user
        ? `ğŸ‘‹ ${user.username} <span class="link" id="btn-logout">Logout é€€å‡º</span>`
        : `<span class="link" id="btn-open-login">Login ç™»å½•</span> Â· <span class="link" id="btn-open-register">Register æ³¨å†Œ</span>`;
      plate.insertAdjacentElement('afterend', chip);

      document.getElementById('btn-open-login')?.addEventListener('click', () => show(document.getElementById('modal-login')));
      document.getElementById('btn-open-register')?.addEventListener('click', () => show(document.getElementById('modal-register')));
      document.getElementById('btn-logout')?.addEventListener('click', onLogout);

      // Hero æŒ‰é’®æ˜¾éš
      const heroBtnRegister = document.getElementById('btn-hero-register');
      const heroBtnLogin = document.getElementById('btn-hero-login');
      if (heroBtnRegister) heroBtnRegister.style.display = user ? 'none' : '';
      if (heroBtnLogin) heroBtnLogin.style.display = user ? 'none' : '';
    }

    document.getElementById('btn-login').onclick = async () => {
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value;
      document.getElementById('login-msg').textContent = 'ç™»å½•ä¸­â€¦ / Logging inâ€¦';
      const res = await fetch(`${API_BASE}/api/v1/auth/login`, {
        method:'POST',
        headers: JSON_HEADERS,
        credentials: 'include',
        body: JSON.stringify({ email, password })
      });
      const json = await res.json().catch(()=>({}));
      if (res.ok && json.ok) {
        accessToken = json.access_token;
        document.getElementById('login-msg').textContent = 'ç™»å½•æˆåŠŸï¼';
        renderAuthChip(json.user);
        setTimeout(() => { hide(document.getElementById('modal-login')); }, 400);
      } else {
        document.getElementById('login-msg').textContent = (json && (json.message || json.code)) || 'ç™»å½•å¤±è´¥ã€‚';
      }
    };

    async function onLogout() {
      await apiPost('/api/v1/auth/logout', {}, { withCookie:true });
      accessToken = null;
      renderAuthChip(null);
    }

    // ===== è¯¾ç¨‹åŠ è½½ + æŠ¥å =====
    async function loadCourses() {
      const grid = document.getElementById('courses-grid');
      grid.innerHTML = '<div class="card">Loadingâ€¦ åŠ è½½ä¸­â€¦</div>';
      const { json } = await apiGet('/api/v1/courses');
      if (json.ok && Array.isArray(json.data)) {
        grid.innerHTML = '';
        json.data.forEach(course => {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h4>${course.title || 'å¾…å®šæ´»åŠ¨'}</h4>
            <div class="meta">Time æ—¶é—´: TBD</div>
            <div class="meta">Location åœ°ç‚¹: TBD</div>
            <div class="meta">Maxmember äººæ•°ä¸Šé™: 30</div>
            <button class="btn primary" data-id="${course.id}">Enroll æŠ¥å</button>
          `;
          grid.appendChild(card);
        });
        grid.querySelectorAll('button[data-id]').forEach(btn => {
          btn.onclick = async () => {
            if (!accessToken) { alert('è¯·å…ˆç™»å½•'); return; }
            const id = btn.getAttribute('data-id');
            const { status, json } = await apiPost(`/api/v1/courses/${id}/enroll`, {}, { withAuth:true });
            if (status === 200 && json.ok) {
              btn.disabled = true;
              btn.textContent = 'å·²æŠ¥å';
              alert('æŠ¥åæˆåŠŸï¼');
            } else {
              alert(json.message || 'æŠ¥åå¤±è´¥');
            }
          };
        });
      } else {
        grid.innerHTML = '<div class="card">æ— æ³•åŠ è½½è¯¾ç¨‹</div>';
      }
    }

    // ===== åˆå§‹åŒ– =====
    renderAuthChip(null);
    loadCourses();
  })();
  </script>
</body>
</html>